# Suggestion 5.2: Add Unit Tests

**Status:** ACCEPTED

**Original Location:** Create tests/ directory

**Rationale:** Catches regressions and enables refactoring. While it adds complexity, testing is essential for robustness. Simple bash-based unit tests for key functions provide clear value without over-engineering.

**Original Content:**

### 5.2 Add Unit Tests
**Location:** Create tests/ directory

**Issue:** No automated testing beyond syntax check.

**Recommendation:**
```bash
# tests/test_ralph.sh
#!/usr/bin/env bash
set -euo pipefail

# Source the main script functions
RALPH_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
source "$RALPH_DIR/ralph.sh"

# Test strip_ansi
test_strip_ansi() {
    local input=$'\x1b[31mRed text\x1b[0m'
    local output=$(strip_ansi <<< "$input")
    [[ "$output" == "Red text" ]] || { echo "strip_ansi failed"; return 1; }
    echo "✓ strip_ansi"
}

# Test json_escape
test_json_escape() {
    local input='Hello "world"'
    local output=$(json_escape "$input")
    [[ "$output" == 'Hello \"world\"' ]] || { echo "json_escape failed"; return 1; }
    echo "✓ json_escape"
}

# Test path validation
test_path_traversal() {
    # Should reject paths with ..
    LOG="../../../etc/passwd"
    [[ ! "$LOG" =~ \.\. ]] || { echo "Path traversal detection failed"; return 1; }
    echo "✓ Path traversal detection"
}

# Run all tests
main() {
    echo "Running ralph unit tests..."
    test_strip_ansi
    test_json_escape
    test_path_traversal
    echo "All tests passed!"
}

main "$@"
```

Add to Makefile:
```makefile
test-unit:
	bash tests/test_ralph.sh

test: test-unit
	@./ralph.sh run --test 1 prompt.md 2>/dev/null && echo "✓ Script runs"
	@bash -n ralph.sh && echo "✓ Syntax valid"
```

**Rationale:** Catches regressions, documents expected behavior, enables refactoring.
